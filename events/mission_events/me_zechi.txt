namespace = me_zechi

me_zechi.1 = {
    type = country_event

    title = me_zechi_1_title
    desc = me_zechi_1_desc
    picture = Event_dothraki_attack_slave_city

    option = {
        name = "me_zechi_1.a"
        custom_tooltip = me_zechi_1_tooltip
        add_country_modifier = {
            name = soul_forts
            duration = -1
        }
    }
}
me_zechi.2 = {
    type = country_event

    title = me_zechi_2_title
    desc = me_zechi_2_desc
    picture = aqueducts

    option = {
        name = "me_zechi_2.a"
        custom_tooltip = me_zechi_2_tooltip
        p:5157 = {
            create_pop = mages
            create_pop = mages
            create_pop = mages
            add_province_modifier = {
                name = empowered_mage_class
                duration = -1
            }
        }
    }
}
me_zechi.300 = {
    type = country_event

    title = me_zechi_3_title
    desc = me_zechi_300_desc
    picture = great_work_supplies

    option = {
        name = "me_zechi_300.a"
        p:5157 = {
            begin_great_work_construction = {
                great_work = "school_of_magecraft"
                locator = primary_great_work
                is_ancient = yes                        
            }
        }
        add_treasury = -500
    }
}
me_zechi.3 = {
    type = country_event

    title = me_zechi_3_title
    desc = me_zechi_3_desc
    picture = great_library

    option = {
        name = "me_zechi_3.a"
        custom_tooltip = me_zechi_3_tooltip
        p:5157 = {
            finish_great_work_construction = {
                great_work = "school_of_magecraft"
                locator = great_work
            }
        }
        current_ruler = {
            add_popularity = popularity_medium
        }
        add_political_influence = 35
        add_stability = 3
    }
}
me_zechi.400 = {
    type = country_event

    title = me_zechi_400_title
    desc = me_zechi_400_desc
    picture = diadochi_new_city_founded

    option = {
        name = "me_zechi_400.a"
        custom_tooltip = elven_magic_2_tt
        add_treasury = -100
        #hidden_effect = {
            create_character = {
                set_character_religion = seekers_beliefs
                set_culture = forest_elves_2
                add_finesse = 2
                add_charisma = 1
                add_zeal = 15
                add_martial = 7
                add_trait = wise
                add_trait = archmage_trait
                save_scope_as = elven_mage
            }
        #}
    }
}
me_zechi.4 = {
    type = country_event

    title = me_zechi_4_title
    desc = me_zechi_4_desc
    picture = slaves_working
    right_portrait = scope:elven_mage

    immediate = {
        hidden_effect = {
            p:5157 = {
                create_pop = mages
                create_pop = mages
                create_pop = mages
                create_pop = mages
                create_pop = mages
                create_pop = mages
                create_pop = mages
                create_pop = nobles
            }
            p:5157 = {
                while = {
                    count = 7
                    random_pops_in_province = {
                        limit = {
                            pop_type = mages
                        }
                        set_pop_culture = forest_elves_2
                        set_pop_religion = mother_earth_pantheon
                    }
                }
                random_pops_in_province = {
                    limit = {
                        pop_type = nobles
                    }
                    set_pop_culture = forest_elves_2
                    set_pop_religion = mother_earth_pantheon
                }
            }
        }
        custom_tooltip = elven_magic_3_tt
    }

    option = {
        name = "me_zechi_4.a"
        custom_tooltip = me_zechi_4_tooltip
        custom_tooltip = elven_magic_5_tt
        hidden_effect = {
            p:5157 = {
                while = {
                    count = 5
                    random_pops_in_province = {
                        limit = {
                            pop_type = mages
                        }
                        kill_pop = yes
                    }
                }
            }
            random_country_culture = {
                limit = {
                    culture = forest_elves_2
                }
                set_country_culture_right = mages
            }
        }
    }
    option = {
        name = "me_zechi_4.b"
        custom_tooltip = me_zechi_4_tooltip
        custom_tooltip = elven_magic_4_tt
        hidden_effect = {
            p:5157 = {
                while = {
                    count = 2
                    random_pops_in_province = {
                        limit = {
                            pop_type = mages
                        }
                        kill_pop = yes
                    }
                }
            }
            p:5157 = {
                random_country_culture = {
                    limit = {
                        culture = forest_elves_2
                    }
                    set_country_culture_right = serfs
                }
            }
        }
        c:LFB = {
            add_opinion = {
                modifier = killed_fugitives
                target = root
            }
        }
        c:LFA = {
            add_opinion = {
                modifier = killed_fugitives
                target = root
            }
        }
    }
}
me_zechi.5 = {
    type = country_event

    title = me_zechi_5_title
    desc = me_zechi_5_desc
    picture = Event_dothraki_hut

    option = {
        name = "me_zechi_5.a"
        custom_tooltip = me_zechi_5_tooltip
        custom_tooltip = establish_lechie_vassal_tt
        hidden_effect = {
            p:5149 = {
                create_country = {
                    name = {
                        name = Lechie
                        adjective = LCH
                    }
                    change_country_tag = LCH
                    if = {
                        limit = {
                            NOT = { primary_culture = western_zerywani_1 }
                        }
                        set_primary_culture_cleanup_effect = {
                            NEW_PRIMARY_CULTURE = western_zerywani_1
                            MAKE_OLD_CULTURE_INTEGRATED = yes
                        }
                    }
                    change_country_flag = lechie_march_flag
                    change_country_color = mid_grey
                    change_government = democratic_republic
                    set_country_heritage = lechie_heritage
                    save_scope_as = lechie_vassal
                    reverse_add_opinion = {
                        modifier = opinion_liberated_us
                        target = root
                    }
                }
            }
            region:lechia_region = {
                every_region_province = {
                    limit = {
                        owned_or_subject_owned = root
                    }
                    set_owned_by = scope:lechie_vassal
                }
            }
            make_subject = {
                target = scope:lechie_vassal
                type = march_vassal
            }
        }
    }
}
me_zechi.6 = {
    type = country_event

    title = me_zechi_6_title
    desc = me_zechi_6_desc
    picture = city_country
    option = {
        name = "me_zechi_6.a"
        custom_tooltip = me_zechi_6_tooltip
        custom_tooltip = claim_zerywani_west_tt
        add_political_influence = -50
        add_treasury = -50
        hidden_effect = {
            region:lechia_region = {
                every_region_province = { add_claim = root }
            }
            region:polabowy_region = {
                every_region_province = { add_claim = root }
            }
            area:navshodia_area_8 = {
                every_area_province = { add_claim = root }
            }
            area:vast_great_stepes_15 = {
                every_area_province = { add_claim = root }
            }
            area:vast_great_stepes_19 = {
                every_area_province = { add_claim = root }
            }
            area:vast_great_stepes_21 = {
                every_area_province = { add_claim = root }
            }
        }
    }
}
me_zechi.7 = {
    type = country_event

    title = me_zechi_7_title
    desc = me_zechi_7_desc
    picture = council_country

    option = {
        name = "me_zechi_7.a"
        custom_tooltip = me_zechi_7_tooltip
        add_country_modifier = {
            name = zechi_unifier
            duration = -1
        }
        current_ruler = {
            add_nickname = the_unifier
        }
    }
}
me_zechi.8 = {
    type = country_event

    title = me_zechi_8_title
    desc = me_zechi_8_desc
    picture = shrine_city

    option = {
        name = "me_zechi_8.a"
        custom_tooltip = me_zechi_8_tooltip
        add_country_modifier = {
            name = conquest_of_old_zechie
            duration = 5300
        }
    }
}
me_zechi.9 = {
    type = country_event

    title = me_zechi_9_title
    desc = me_zechi_9_desc
    picture = looting

    option = {
        name = "me_zechi_9.a"
        custom_tooltip = me_zechi_9_tooltip
        ordered_owned_province = {
            limit = {
                OR = {
                    dominant_province_culture = alaguric_1
                    dominant_province_culture = alaguric_2
                    dominant_province_culture = alaguric_3
                    dominant_province_culture = alaguric_4
                }
            }
            order_by = total_population
            max = 5
            ordered_pops_in_province = {
                limit = {
                    OR = {
                        pop_culture = alaguric_1
                        pop_culture = alaguric_2
                        pop_culture = alaguric_3
                        pop_culture = alaguric_4
                    }
                order_by = pop_hapiness
                max = 3
                }
                kill_pop = yes
            }
        }
        hidden_effect = {
            every_province = {
                limit = {
                    OR = {
                        dominant_province_culture = alaguric_1
                        dominant_province_culture = alaguric_2
                        dominant_province_culture = alaguric_3
                        dominant_province_culture = alaguric_4
                    }
                }
                add_province_modifier = {
                    name = repopulation_efforts
                    duration = 9125 # 25 years
                }
            }
        }
        custom_tooltip = repopulation_tt
        show_as_tooltip = {
            p:5172 = {
                add_province_modifier = {
                    name = repopulation_efforts
                    duration = 9125 # 25 years
                }
            }
        }
    }
}
me_zechi.10 = {
    type = country_event

    title = me_zechi_10_title
    desc = me_zechi_10_desc
    picture = greek_religious_rite

    option = {
        name = "me_zechi_10.a"
        custom_tooltip = me_zechi_10_tooltip
        add_country_modifier = {
            name = magic_of_politics
            duration = -1
        }
        current_ruler = {
            add_zeal = 2
            add_finesse = 1
            add_popularity = 10
        }
        add_legitimacy = 10
    }
}
me_zechi.11 = {
    type = country_event

    title = me_zechi_11_title
    desc = me_zechi_11_desc
    picture = great_library

    option = {
        name = "me_zechi_11.a"
        custom_tooltip = me_zechi_11_tooltip
        change_government = magic_monarchy
        add_4_free_province_investments = yes
        add_innovation = 2
        change_country_name = celestial_kingdom_name
        change_country_adjective = zechii_adj
        change_country_color = light_purple
    }
}
me_zechi.12 = {
    type = country_event

    title = me_zechi_12_title
    desc = me_zechi_12_desc
    picture = tyre_city

    option = {
        name = "me_zechi_12.a"
        custom_tooltip = me_zechi_12_tooltip
        p:5121 = {
            set_trade_goods = elixir
            add_province_modifier = {
                name = increased_elixer_production
                duration = -1
            }
            set_city_status = city
            create_pop = mages
        }
    }
}
me_zechi.13 = {
    type = country_event

    title = me_zechi_13_title
    desc = me_zechi_13_desc
    picture = ascetic

    option = {
        name = "me_zechi_13.a"
        custom_tooltip = me_zechi_13_tooltip
        add_country_modifier = {
            name = elixer_of_magic
            duration = -1
        }
    }
}
me_zechi.14 = {
    type = country_event

    title = me_zechi_14_title
    desc = me_zechi_14_desc
    picture = ascetic

    option = {
        name = "me_zechi_14.a"
        custom_tooltip = me_zechi_14_tooltip
        add_country_modifier = {
            name = elixir_of_harm
            duration = -1
        }
    }
}
me_zechi.15 = {
    type = country_event

    title = me_zechi_15_title
    desc = me_zechi_15_desc
    picture = senator_conversing

    option = {
        name = "me_zechi_15.a"
        custom_tooltip = me_zechi_15_tooltip
        add_country_modifier = {
            name = elixir_of_soul
            duration = -1
        }
        hidden_effect = {
            trigger_event = {
                id = me_zechi.16
                days = { 180 365 }
            }
        }
    }
    option = {
        name = "me_zechi_15.b"
        custom_tooltip = me_zechi_15_tooltip
        add_treasury = 100
        add_stability = 3
    }
}

me_zechi.16 = {
    type = country_event
    title = me_zechi_16_title
    desc = me_zechi_16_desc
    picture = persepolis

    left_portrait = current_ruler

    option = {
        name = "me_zechi_16.a"
        if = {
            limit = {
                is_monarchy = yes
            }
            add_legitimacy = subtract_legitimacy_medium
        }
        trigger_event = {
            id = me_zechi.17
            days = { 365 720 }
        }
    }
}
# The Curse of Maat (Province Rebellion)
me_zechi.17 = {
    type = country_event
    title = "me_zechi_17_title"
    desc = "me_zechi_17_desc"
    picture = looting_dishonor
    #fire_only_once = yes

    left_portrait = scope:soul_mage
    right_portrait = scope:soul_mage

    goto_location = p:5121

    trigger = {
        owns = 5121
    }

    immediate = {
        hidden_effect = {
                hidden_effect = {
                create_character = {
                    first_name = "esencja"
                    family_name = "the_destroyer_of_souls"
                    add_martial = 13
                    add_zeal = 20
                    add_charisma = 7
                    add_finesse = 3
                    set_character_religion = soul_cult
                    set_culture = western_zerywani_3
                    add_trait = lunatic
                    add_trait = blind
                    add_trait = cruel
                    save_scope_as = soul_mage
                }
            }
        }
        hidden_effect = {
            p:5121 = {
                while = {
                    count = 10
                    random_pops_in_province = {
                        set_pop_religion = soul_cult
                        set_pop_culture = western_zerywani_3
                    }
                }
                create_country = {
                    change_country_name = "SOUL_REBELLION_NAME"
                    change_country_flag = "SOUL_FLAG"
                    change_government = magic_monarchy
                    set_country_heritage = soul_heritage
                    change_country_color =  "soul_color"
                    set_country_religion = soul_cult
                    set_primary_culture = western_zerywani_3
                    save_scope_as = copied_from_dementive
                    change_country_tag = SDC
                    set_variable = {
                        name = is_not_allowed_to_go_broke
                        days = 9125
                    }
                    set_variable = {
                        name = is_ignoring_ae
                        days = 3650
                    }
                }
                add_vfx = {
                    name = "mage_storm"
                    duration = 365
                }
                every_neighbor_province = {
                    limit = {
                        NOT = { has_province_modifier = mage_storm }
                    }
                    add_vfx = {
                        name = "mage_storm"
                        duration = 365
                    }
                }                    
            }
            p:5172 = {
                add_vfx = {
                    name = "mage_storm"
                    duration = 365
                }
                every_neighbor_province = {
                    limit = {
                        NOT = { has_province_modifier = mage_storm }
                    }
                    add_vfx = {
                        name = "mage_storm"
                        duration = 365
                    }
                }
            }
            p:5014 = {
                add_vfx = {
                    name = "mage_storm"
                    duration = 365
                }
                every_neighbor_province = {
                    limit = {
                        NOT = { has_province_modifier = mage_storm }
                    }
                    add_vfx = {
                        name = "mage_storm"
                        duration = 365
                    }
                }
            }
            p:5090 = {
                add_vfx = {
                    name = "mage_storm"
                    duration = 365
                }
                every_neighbor_province = {
                    limit = {
                        NOT = { has_province_modifier = mage_storm }
                    }
                    add_vfx = {
                        name = "mage_storm"
                        duration = 365
                    }
                }
            }
            p:5013 = {
                add_vfx = {
                    name = "mage_storm"
                    duration = 365
                }
                every_neighbor_province = {
                    limit = {
                        NOT = { has_province_modifier = mage_storm }
                    }
                    add_vfx = {
                        name = "mage_storm"
                        duration = 365
                    }
                }
            }
            p:4850 = {
                add_vfx = {
                    name = "mage_storm"
                    duration = 365
                }
                every_neighbor_province = {
                    limit = {
                        NOT = { has_province_modifier = mage_storm }
                    }
                    add_vfx = {
                        name = "mage_storm"
                        duration = 365
                    }
                }
            }                                                                                               
            scope:soul_mage = {
                remove_all_positions = yes
                move_country = scope:copied_from_dementive
                set_home_country = scope:copied_from_dementive
                remove_character_modifier = foreign_citizen
            } 
            scope:copied_from_dementive = {
                add_treasury = 2000
                add_manpower = 20
                set_as_ruler = scope:soul_mage
                if = {
                    limit = {
                        NOR = {
                            has_law = republican_recruitment_2 # legions capital
                            has_law = republican_recruitment_4 # legions enabled
                        }
                    }
                    change_law = republican_recruitment_2 # capital
                }
            create_character = {
                culture = root.culture
                    religion = soul_cult
                    age = 34
                    female = no
                    no_stats = yes
                    no_traits = yes
                    hidden_effect = {
                        good_martial_effect = yes
                        good_charisma_effect = yes
                        average_finesse_effect = yes
                        bad_zeal_effect = yes
                        add_trait = brave
                        add_trait = proud
                        add_trait = aggressive
                    }
                    save_scope_as = isfet_general
                }
                capital_scope.governorship = {
                    raise_legion = {
                        save_scope_as = isfet_legion
                        create_unit = {
                            location = p:5121 # Napkor
                            save_scope_as = isfet_unit
                            every_sub_unit = { set_personal_loyalty = scope:soul_mage }
                            #15 Camels, 3 Archers and 5 HI
                            add_loyal_subunit = heavy_cavalry
                            add_loyal_subunit = heavy_cavalry
                            add_loyal_subunit = heavy_cavalry
                            add_loyal_subunit = heavy_cavalry
                            add_loyal_subunit = heavy_cavalry
                            add_loyal_subunit = heavy_cavalry
                            add_loyal_subunit = heavy_cavalry
                            add_loyal_subunit = heavy_cavalry
                            add_loyal_subunit = heavy_cavalry
                            add_loyal_subunit = heavy_cavalry  
                            add_loyal_subunit = heavy_cavalry
                            add_loyal_subunit = heavy_cavalry
                            add_loyal_subunit = heavy_cavalry
                            add_loyal_subunit = heavy_cavalry
                            add_loyal_subunit = heavy_cavalry
                            add_loyal_subunit = archers
                            add_loyal_subunit = archers
                            add_loyal_subunit = archers
                            add_loyal_subunit = heavy_infantry
                            add_loyal_subunit = heavy_infantry
                            add_loyal_subunit = heavy_infantry
                            add_loyal_subunit = heavy_infantry
                            add_loyal_subunit = heavy_infantry                                     
                        }
                    }
                }
            }
            scope:isfet_legion = {
                add_commander = scope:isfet_general
            }
            scope:isfet_unit = {
                set_as_commander = scope:isfet_general
            }                       
            p:5121.area = {
                every_area_province = {
                limit = { owned_or_subject_owned = root }
                    set_owned_by = scope:copied_from_dementive
                }               
            }
            p:5055.region = {
                every_region_province = {
                limit = { owned_or_subject_owned = root }
                    set_owned_by = scope:copied_from_dementive
                }               
            } 
            p:5060.region = {
                every_region_province = {
                limit = { owned_or_subject_owned = root }
                    set_owned_by = scope:copied_from_dementive
                }               
            } 
            p:5121 = { # capital fort
                state = { set_state_capital = p:5121 }
                if = {
                    limit = { can_build_building = fortress_building }
                    add_building_level = fortress_building
                }
            }
            p:5121.owner = {
                declare_war_with_wargoal = {
                    war_goal = imperial_conquest_wargoal
                    province = root.capital_scope
                    target = ROOT
                }                
            }                       
        }
    }

    option = {  ##Maat has Cursed Us!
        name = me_zechi_17.a"
        add_political_influence = -25
        add_country_modifier = {
            name = soul_devourer_disaster
            duration = 730
        }
    }
}