namespace = saptarum

saptarum.start = {
    type = country_event
    hidden = yes

    trigger = {
        tag = SV2
    } 

    fire_only_once = yes    

    immediate = {
        trigger_event = {
                id = saptarum.1
                days = { 345 385 }
        }
    }
}

saptarum.1 = {
    type = country_event
    title = saptarum.1.t
    desc = saptarum.1.desc
    picture = revolt
    
    goto_location = p:2559
    left_portrait = current_ruler
    right_portrait = scope:rebel_scum

    trigger = {
        tag = SV2
    }     

    fire_only_once = yes

    immediate = {
        char:90 = {
            save_scope_as = rebel_scum
        }
        random_family = {
            limit = {
                this = root.char:116.family
            }
            save_scope_as = segurrvelk_family
        }
    }

    option = {      
        ai_chance = { factor = 1 }
        name = saptarum.1.a
        start_civil_war = scope:rebel_scum
        hidden_effect = { 
            scope:rebel_scum.employer = {
                change_country_name = "Saptarum Pretender"
                change_country_adjective = "Pretender"
                change_country_color = forrj_red
                change_country_flag = "SV2"
                change_government = feudal_monarchy
                save_scope_as = saptarum_revolt_country
            }
        }
        hidden_effect = {
            create_unit = {
                navy = no
                name = "Emergency Levies"
                location = capital_scope
                hidden_effect = {
                    add_subunit = heavy_infantry
                    add_subunit = heavy_infantry
                    add_subunit = light_infantry
                    add_subunit = light_infantry 
                    add_subunit = light_cavalry                                        
                    add_food = 150
                    add_morale = 3
                }
            }
        }
        add_stability = -15
    }
    option = {      
        name = saptarum.1.b
        c:SV2 = {
			change_government = feudal_monarchy
            set_as_ruler = scope:rebel_scum
		}
        add_stability = -10
        hidden_effect = {
            if = {
                limit = {
                    exists = scope:segurrvelk_family
                }
                hidden_effect = {
                    scope:segurrvelk_family = {
                        every_family_member = {
                            death = {
                                death_reason = death_obscurity
                                silent = yes
                            }
                        }
                    }
                }
            }
        }
    }
}

### WILL BECOME PART OF THE EVENT
saptarum.2 = {
    type = country_event
    title = saptarum.2.t
    desc = saptarum.2.desc
    picture = revolt
    
    goto_location = p:2559
    left_portrait = current_ruler

    fire_only_once = yes

    immediate = {
        p:2559 = {
            define_pop = {
                type = citizen
                culture = itllmurren
                religion = the_old_father_silver
            }
            define_pop = {
                type = citizen
                culture = itllmurren
                religion = the_old_father_silver
            }
            define_pop = {
                type = citizen
                culture = itllmurren
                religion = the_old_father_silver
            }
        }
        random_owned_province = {
            random_pops_in_province = {
                set_pop_culture = itllmurren
                set_pop_religion = the_old_father_silver
            }
            random_pops_in_province = {
                set_pop_culture = itllmurren
                set_pop_religion = the_old_father_silver
            }
        }
        random_owned_province = {
            random_pops_in_province = {
                set_pop_culture = itllmurren
                set_pop_religion = the_old_father_silver
            }
            random_pops_in_province = {
                set_pop_culture = itllmurren
                set_pop_religion = the_old_father_silver
            }
        }
        random_owned_province = {
            random_pops_in_province = {
                set_pop_culture = itllmurren
                set_pop_religion = the_old_father_silver
            }
            random_pops_in_province = {
                set_pop_culture = itllmurren
                set_pop_religion = the_old_father_silver
            }
        }
        add_stability = -5
    }

    option = {      
        name = saptarum.2.a
        random_country_culture = {
            limit = {
                is_culture = itllmurren
            }
            if = {
                limit = { is_integrated = no }
                ROOT = { integrate_country_culture = PREV }
            }
        }
        add_stability = -10
    }
    option = {      
        name = saptarum.2.b
        hidden_effect = {
            create_character = {
            first_name = "Sicrvus"
            age = 25
            culture = itllmurren
            religion = the_old_father_silver
            female = no
            good_popularity_trait_effect = yes
            save_scope_as = shalfling_king
            }
        p:5604 = {
            create_country = {
                set_country_religion = the_old_father_silver
                if = {
                       limit = {
                           NOT = {
                                primary_culture = itllmurren
                        }
                    }
                    set_primary_culture_cleanup_effect = {
                        NEW_PRIMARY_CULTURE = itllmurren
                        MAKE_OLD_CULTURE_INTEGRATED = yes
                    }
                }
                change_country_name = "Itllri"
                change_country_color = "forrj_red"
                change_government = feudal_monarchy
                change_country_adjective = "Silver Halfling"
                change_country_flag = 'SV2'
                save_scope_as = silver_smallville
            }
        }
        scope:shalfling_king = {
            remove_all_positions = yes
            move_country = scope:silver_smallville
            set_home_country = scope:silver_smallville
            remove_character_modifier = foreign_citizen
        }
        p:3315 = {
            limit = {
                NOT = { owner = scope:silver_smallville }
                owner = c:SV2
            }
            define_pop = {
                type = citizen
                culture = itllmurren
                religion = the_old_father_silver
            }
            define_pop = {
                type = citizen
                culture = itllmurren
                religion = the_old_father_silver
            }
            define_pop = {
                type = citizen
                culture = itllmurren
                religion = the_old_father_silver
            }
            define_pop = {
                type = citizen
                culture = itllmurren
                religion = the_old_father_silver
            }
            define_pop = {
                type = citizen
                culture = itllmurren
                religion = the_old_father_silver
            }
            random_owned_province = {
                random_pops_in_province = {
                    set_pop_culture = itllmurren
                    set_pop_religion = the_old_father_silver
                }
                random_pops_in_province = {
                    set_pop_culture = itllmurren
                    set_pop_religion = the_old_father_silver
                }
                random_pops_in_province = {
                    set_pop_culture = itllmurren
                    set_pop_religion = the_old_father_silver
                }
                random_pops_in_province = {
                    set_pop_culture = itllmurren
                    set_pop_religion = the_old_father_silver
                }
            }
            set_owned_by = scope:silver_smallville
        }
        p:3347 = {
            limit = {
                NOT = { owner = scope:silver_smallville }
                owner = c:SV2
            }
            define_pop = {
                type = citizen
                culture = itllmurren
                religion = the_old_father_silver
            }
            define_pop = {
                type = citizen
                culture = itllmurren
                religion = the_old_father_silver
            }
            define_pop = {
                type = citizen
                culture = itllmurren
                religion = the_old_father_silver
            }
            define_pop = {
                type = citizen
                culture = itllmurren
                religion = the_old_father_silver
            }
            define_pop = {
                type = citizen
                culture = itllmurren
                religion = the_old_father_silver
            }
            random_owned_province = {
                random_pops_in_province = {
                    set_pop_culture = itllmurren
                    set_pop_religion = the_old_father_silver
                }
                random_pops_in_province = {
                    set_pop_culture = itllmurren
                    set_pop_religion = the_old_father_silver
                }
                random_pops_in_province = {
                    set_pop_culture = itllmurren
                    set_pop_religion = the_old_father_silver
                }
                random_pops_in_province = {
                    set_pop_culture = itllmurren
                    set_pop_religion = the_old_father_silver
                }
            }
            set_owned_by = scope:silver_smallville
        }
        p:3269 = {
            limit = {
                NOT = { owner = scope:silver_smallville }
                owner = c:SV2
            }
            define_pop = {
                type = citizen
                culture = itllmurren
                religion = the_old_father_silver
            }
            define_pop = {
                type = citizen
                culture = itllmurren
                religion = the_old_father_silver
            }
            define_pop = {
                type = citizen
                culture = itllmurren
                religion = the_old_father_silver
            }
            define_pop = {
                type = citizen
                culture = itllmurren
                religion = the_old_father_silver
            }
            define_pop = {
                type = citizen
                culture = itllmurren
                religion = the_old_father_silver
            }
            random_owned_province = {
                random_pops_in_province = {
                    set_pop_culture = itllmurren
                    set_pop_religion = the_old_father_silver
                }
                random_pops_in_province = {
                    set_pop_culture = itllmurren
                    set_pop_religion = the_old_father_silver
                }
                random_pops_in_province = {
                    set_pop_culture = itllmurren
                    set_pop_religion = the_old_father_silver
                }
                random_pops_in_province = {
                    set_pop_culture = itllmurren
                    set_pop_religion = the_old_father_silver
                }
            }
            set_owned_by = scope:silver_smallville
        }
        scope:silver_smallville = {
            add_treasury = 1000
            add_manpower = 20
            set_as_ruler = scope:shalfling_king
            if = {
                limit = {
                    NOR = {
                        has_law = republican_recruitment_2 # legions capital
                        has_law = republican_recruitment_4 # legions enabled
                    }
                }
                change_law = republican_recruitment_2 # capital
            }
        }
        p:3315 = { # capital fort
            state = { set_state_capital = p:3315 }
            if = {
                limit = { can_build_building = fortress_building }
                add_building_level = fortress_building
            }
        }
    }
    add_stability = 10
    }
}
