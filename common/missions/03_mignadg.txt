03_mignadg = {
    header = "lotr_umbar_mission_header"
    icon = "lotr_generic_ship_mission_icon"

    repeatable = no
    chance = 1000

    potential = {
    	OR = {
            tag = UP4
            tag = ULP
        }
        exists = c:UP4
        NOT = { has_variable = mission_cooldown_var }
    }

    abort = {}
    on_start = {
        start_mission_ai_effect = yes
        hidden_effect = {
            reverse_add_opinion = { target = UPJ modifier = opinion_declared_war  }
        }
    }
    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = mission_cooldown_var
            days = 7300
        }
    }
    on_completion = {
        capital_scope = {
            capital_formable_huge_effect = yes
        }
    }

    03_mignadg_task_1 = {
        icon = "task_diplomatic"
        duration = 30

        bypass = {
     		owns_or_subject_owns = 5700
     		owns_or_subject_owns = 5698
     		owns_or_subject_owns = 5690
        }

        highlight = {
			scope:province = {
				OR = {
                    owner = c:UP6
                    owner = c:UP3
                    owner = c:UP5
                }
			}
		}

        allow = {
        	political_influence >= 15
        	treasury >= 35
        	has_law = barter_economy_law
			hidden:c:UP3 = {
					opinion = {
						target = root
						value >= 150
					}
				}
			hidden:c:UP5 = {
				opinion = {
					target = root
					value >= 150
				}
			}
			hidden:c:UP6 = {
				opinion = {
					target = root
					value <= 150
				}
			}
        }

        on_completion = {
        	custom_tooltip = mignadg_feudatory_mission_tt
            trigger_event = me_mignadg.1
            add_treasury = -35
            show_as_tooltip = {
            	current_ruler = {
            	force_add_trait = ambitious
            	}
            }
        }
    }

    03_mignadg_task_2 = {
        icon = "task_expansion"

        highlight = {
			scope:province = {
				owner = root
				is_capital = yes
			}
		}

        allow = {
        	capital_scope = {
        		num_of_port_building >= 2
        		is_importing_trade_good = wood
        		is_importing_trade_good = stone
        	}
        }
        on_completion = {
            trigger_event = me_mignadg.2
            add_manpower = 2
            capital_scope = {
            	add_permanent_province_modifier = {
            		name = mignadg_port_capital_mod
            		duration = -1
            	}
            }
        }
    }

    03_mignadg_task_3 = {
        icon = "task_political"
        duration = 90

        allow = {
        	political_influence >= 30
        	num_of_ships >= 10
        	invention = pirate_spawn_chance_inv_1 
        }

        requires = {03_mignadg_task_1}
        on_completion = {
        	add_political_influence = -30
        	area:austropetolian_archipelago_2 = {
                add_provincial_claim_effect = yes
            }
            area:austropetolian_archipelago_3 = {
                add_provincial_claim_effect = yes
            }
            area:austropetolian_archipelago_4 = {
                add_provincial_claim_effect = yes
            }
            trigger_event = me_mignadg.3
            show_as_tooltip = {

            }
        }
    }

    03_mignadg_task_4 = {
        icon = "task_conquest"
        requires = {03_mignadg_task_3}

        highlight = {
			scope:province = {
                OR = {
                    is_in_area = austropetolian_archipelago_2
                    is_in_area = austropetolian_archipelago_3
                    is_in_area = austropetolian_archipelago_4
                }
            }
	    }

        allow = {
            num_of_ships >= 20
            owns_percent_of_area = {
                PROVINCE = "p:5585" 
                PERCENT = "0.75"
            }
            owns_percent_of_area = {
                PROVINCE = "p:5583" 
                PERCENT = "0.75"
            }
            owns_percent_of_area = {
                PROVINCE = "p:5600" 
                PERCENT = "0.75"
            }
        }

        on_completion = {
            area:austropetolian_isle_3 = {
                add_provincial_claim_effect = yes
            }
            area:austropetolian_isle_7 = {
                add_provincial_claim_effect = yes
            }
            trigger_event = me_mignadg.4
            show_as_tooltip = {

            }
        }
    }

    03_mignadg_task_5 = {
        icon = "task_political"
        requires = {03_mignadg_task_4}

        highlight = {
			scope:province = {
				owner = c:UPJ
			}
		}

        allow = {
            war = no
            c:UPJ = {
                has_land = no
            }
        }
        on_completion = {
            create_country_treasure = {
                key = "euryalean_regalia_treasure"
                icon = "treasure_it_helmet_of_zalmoxis"
                modifier = {
                    local_country_civilization_value = 5
                    garrison_size = 0.1
                    local_building_slot = 2
                }
            }
            current_ruler = {
                positive_martial_trait_effect = yes
            }
            area:austropetolian_isle_2 = {
                add_provincial_claim_effect = yes
            }
            area:austropetolian_isle_3 = {
                add_provincial_claim_effect = yes
            }
            area:austropetolian_isle_4 = {
                add_provincial_claim_effect = yes
            }
            area:austropetolian_isle_5 = {
                add_provincial_claim_effect = yes
            }
            area:austropetolian_isle_6 = {
                add_provincial_claim_effect = yes
            }
            trigger_event = me_mignadg.5
            show_as_tooltip = {
                p:5607 = {
                    set_city_status = settlement
                }
            }
        }
    }

    03_mignadg_task_6 = {
        icon = "task_economical"
        requires = {03_mignadg_task_2}

        highlight = {
			scope:province = {
				OR = {
				province_id = 5692
				province_id = 5694
				}
			}
		}

        allow = {
        	p:5692 = {
        		has_building = latifundia_building
        		total_population >=13
        	}
        	capital_scope = {
        		num_of_port_building >= 3
        		has_building = military_building
        	}
        }
        on_completion = {
            trigger_event = me_mignadg.6
            p:5692 = {
            	remove_province_modifier = pirate_haven_modifier
            }
            capital_scope = {
            	add_permanent_province_modifier = {
            		name = pirate_haven_modifier
            		duration = -1
            	}
            	add_permanent_province_modifier = {
            		name = the_buccaneer_district_snake_mod
            		duration = -1
            	}
            }
            show_as_tooltip = {

            }
        }
    }

    03_mignadg_task_7 = {
        icon = "task_calm"
        requires = {03_mignadg_task_6}

        highlight = {
			scope:province = {
				province_id = 5694
			}
		}

        allow = {
            capital_scope = {
                has_building = commerce_building
                has_building = town_hall_building
        		num_of_port_building >= 3
                has_no_ongoing_construction = yes  
        	}
            capital_scope.state = {
                incoming_trade_routes >= 3
            }
        }
        on_completion = {
            add_treasury = 150
            add_1_free_province_investments = yes
            add_country_modifier = {
                name = midnadg_business_is_booming_mod
                duration = 7300
            }
            trigger_event = me_mignadg.7
            show_as_tooltip = {

            }
        }
    }

    03_mignadg_task_8 = {
        icon = "task_expansion"
        requires = {03_mignadg_task_7}
        duration = 180

        highlight = {
			scope:province = {
				province_id = 5697
			}
		}

        allow = {
            hidden:p:5697 = {
                has_building = port_building
            }
            civic_tech >= 3
            invention = capital_trade_inv_2
            has_military_bonus = snakefolk_pirate_path_3  
        }
        on_completion = {
            capital_scope = {
                add_permanent_province_modifier = {
                    name = the_straight_of_greegroknlp_mod
                    duration = -1
                }
            }
            p:5697 = {
                set_city_status = city
                add_permanent_province_modifier = {
            		name = mignadg_port_capital_mod
            		duration = -1
            	}
            }
            trigger_event = me_mignadg.8
            show_as_tooltip = {

            }
        }
    }

    03_mignadg_task_9 = {
        icon = "task_political"

        highlight = {
			scope:province = {
                OR = {
                    is_in_area = austropetolian_isle_2
                    is_in_area = austropetolian_isle_3
                    is_in_area = austropetolian_isle_4
                    is_in_area = austropetolian_isle_5
                    is_in_area = austropetolian_isle_6
                }
            }
	    }

        requires = {03_mignadg_task_5 03_mignadg_task_8}
        allow = {
            num_of_ships >= 35
            owns_percent_of_area = {
                PROVINCE = "p:5630" 
                PERCENT = "0.75"
            }
            owns_percent_of_area = {
                PROVINCE = "p:5638" 
                PERCENT = "0.75"
            }
            owns_percent_of_area = {
                PROVINCE = "p:5653" 
                PERCENT = "0.75"
            }
            owns_percent_of_area = {
                PROVINCE = "p:5662" 
                PERCENT = "0.75"
            }
            owns_percent_of_area = {
                PROVINCE = "p:5678" 
                PERCENT = "0.75"
            }
        }
        on_completion = {
            trigger_event = me_mignadg.9
            add_military_experience = 80
            show_as_tooltip = {

            }
        }
    }

    03_mignadg_task_10 = {
        icon = "task_atlas"
        requires = {03_mignadg_task_9}
        final = yes
        allow = {
            custom_tooltip = {
                text = you_need_to_form_empire_ular_pria
                tag = ULP
            }
        }
        on_completion = {
        current_ruler = {
            add_martial = 1
            add_zeal = 1
            add_finesse = 1
            add_charisma = 1
            family = {
                add_prestige = prestige_huge
            }
        } 
        add_country_modifier = {
            name = empire_of_serpents_mod
            duration = 7300
        }
        area:eptelon_shout_area_10 = {
            add_provincial_claim_effect = yes
        }
        area:arteon_eastern_area_2  = {
            add_provincial_claim_effect = yes
        }
        area:morrigan_borderlands_2 = {
            add_provincial_claim_effect = yes
        }
        area:bloody_islands_rendun_area_6 = {
            add_provincial_claim_effect = yes
        }
        trigger_event = me_mignadg.10
        show_as_tooltip = {

        }
    }
    }

    03_mignadg_task_11 = {
        icon = "task_economical"
        requires = {03_mignadg_task_1 03_mignadg_task_2}

        highlight = {
			scope:province = {
				OR = {
					province_id = 5693
					province_id = 5695
				}
			}
		}

        allow = {
        	p:5693 = {
				num_of_latifundia_building >= 1
			}
            p:5695 = {
				num_of_latifundia_building >= 1
			}
        }

        requires = {03_mignadg_task_1}
        on_completion = {
        	p:5693 = {
                add_province_modifier = {
                    name = snake_sugar_farms_mod
                    duration = -1
                }
            }
            p:5695 = {
                add_province_modifier = {
                    name = snake_sugar_farms_mod
                    duration = -1
                }
            }
            trigger_event = me_mignadg.11
        }
    }
    03_mignadg_task_12 = {
        icon = "task_apollo"
        requires = {03_mignadg_task_11}
        duration = 60

        highlight = {
			scope:province = {
				province_id = 5696
			}
		}

        allow = {
            p:5696 = {
				num_of_latifundia_building >= 1
			}
            capital_scope.state = {
                incoming_trade_routes >= 5
            }
            treasury >= 100
        }
        on_completion = {
            add_treasury = -100
            p:5694 = {
				add_road_towards = 5696
			}
            p:5694 = {
				add_road_towards = 5695
			}
            p:5694 = {
				add_road_towards = 5693
			}
            p:5694 = {
				add_road_towards = 5692
			}
            trigger_event = me_mignadg.12
            show_as_tooltip = {

            }
        }
    }

    03_mignadg_task_13 = {
        icon = "task_diplomatic"
        requires = {03_mignadg_task_4 03_mignadg_task_7 03_mignadg_task_12}
        duration = 90

        highlight = {
			scope:province = {
				province_id = 5694
			}
		}

        allow = {
            capital_scope = {
                num_of_commerce_building >= 3
        	}
            invention = build_time_inv
        }
        on_completion = {
            capital_scope = {
                add_permanent_province_modifier = {
                    name = grand_market_at_iprnk_mod
                    duration = -1
                }
            }
            trigger_event = me_mignadg.13
        }
    }
}