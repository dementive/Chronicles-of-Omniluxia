03_azar = {
    header = "lotr_generic_mission_city_headers"
    icon = "lotr_generic_army_mission_icon"

    repeatable = no
    chance = 1000

    potential = {
        NOT = { has_variable = mission_cooldown_var }
        tag = AKK
    }

    abort = {}
    on_start = {
        start_mission_ai_effect = yes
    }
    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = mission_cooldown_var
            days = 7300
        }
    }
    on_completion = {
        capital_scope = {
            capital_formable_medium_effect = yes
        }
    }

    03_azar_task_1 = {
        icon = "task_diplomatic"
        requires = {03_azar_task_2}
        allow = {
            custom_tooltip = {
                text = we_need_to_rebuild_ziggurat_tt
                has_variable = rebuilt_azar_ziggurat_var
            }
        }
        on_completion = {
            current_ruler = {
                force_add_trait = founder
                family = {
                    add_prestige = 100
                }
            }
            trigger_event = me_azar.1
        }
    }

    03_azar_task_2 = {
        icon = "task_political"
        duration = 180

        allow = {
            invention = civic_tech_investment_inv_2
            treasury >= 150
            political_influence >= 25 
        }
        on_completion = {
            add_treasury = -150
            add_political_influence = -25
            capital_scope = {
                add_permanent_province_modifier = {
                    name = expanded_canals_of_tiuban_mod
                    duration = -1
                }
            }
            trigger_event = me_azar.2
        }
    }

    03_azar_task_3 = {
        icon = "task_religion"
        requires = {03_azar_task_1}

        highlight = {
            scope:province = {
                 this = p:4262
            }
        }

        allow = {
            invention = happiness_for_wrong_group_modifier_inv_1
            capital_scope = {
                is_importing_trade_good = incense
            }
        }

        on_completion = {
            trigger_event = me_azar.3
            current_ruler = {
                good_zeal_effect = yes
                add_popularity = 15
            }
            add_1_free_province_investments = yes
        }
    }

    03_azar_task_4 = {
        icon = "task_expansion"
        requires = {03_azar_task_1}

        allow = {
            invention = agressive_expansion_impact_inv_1
            stability >= 60
        }

        on_completion = {
            trigger_event = me_azar.4
            current_ruler = {
                add_nickname = "viceroy_of_measis_nickname"
            }
            create_country_treasure = {
                key = "treasure_azar_rhyton_of_measis"
                icon = "cr_treasure_golden_lion_rhyton_01"
                modifier = {
                    local_population_happiness = 0.05
                    local_tax_modifier = 0.05
                }
            }
        }
    }
    
    03_azar_task_5 = {
        icon = "task_battle"
        duration = 30

        bypass = {
            c:LRS = {
                has_land = no
            }
        }

        allow = {
            political_influence >= 15 
        }

        on_completion = {
            add_political_influence = -15 
            c:LRS = {
				every_owned_province = {
					add_claim = root
				}
			}
            trigger_event = me_azar.5
            show_as_tooltip = {

            }
        }
    }
    03_azar_task_6 = {
        icon = "task_conquest"
        requires = {03_azar_task_5}
        duration = 60

        highlight = {
            scope:province = {
                 this = p:4293
            }
        }

        allow = {
            owns_or_subject_owns = 4293
            treasury >= 50
            political_influence >= 15 
        }

        on_completion = {
            add_treasury = -50
            add_political_influence = -15
            area:the_iron_foothill_2 = {
                add_provincial_claim_effect = yes
			}
            area:the_iron_foothill_3 = {
                add_provincial_claim_effect = yes
			}
            area:the_iron_foothill_4 = {
                add_provincial_claim_effect = yes
			}
            area:the_iron_foothill_5 = {
                add_provincial_claim_effect = yes
			}
            create_unit = {
                navy = no
                name = "Bel-bani Raiders"
                location = capital_scope
                hidden_effect = {
                add_subunit = light_infantry
                add_subunit = light_infantry
                add_subunit = light_infantry
                add_subunit = light_infantry                                          
                add_food = 100
                add_morale = 2
                }
            }
            add_country_modifier = {
                name = belbani_raiders_mod
                duration = 7300
            }
            trigger_event = me_azar.6
            show_as_tooltip = {

            }
        }
    }
    03_azar_task_7 = {
        icon = "task_battle"
        requires = {03_azar_task_6}

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = the_iron_foothill_3
                    is_in_area = the_iron_foothill_4
                    is_in_area = the_iron_foothill_5
                }
            }
        }

        allow = {
            political_influence >= 15
            owns_or_subject_owns_area = the_iron_foothill_3
            owns_or_subject_owns_area = the_iron_foothill_4
            owns_or_subject_owns_area = the_iron_foothill_5
        }


        on_completion = {
            current_ruler = {
                add_martial = 1
            }
            add_political_influence = -15
            p:4361 = {
				add_road_towards = 4437
			}
            p:4437 = {
				add_road_towards = 4542
			}
            custom_tooltip = we_will_receive_claims_on_gezara_tt
            hidden_effect = {
                c:URU = {
                    every_owned_province = {
                        add_claim = root
                    }
                }
            }
            trigger_event = me_azar.7
        }
    }

    03_azar_task_8 = {
        icon = "task_heracles"
        requires = { 03_azar_task_9}
        duration = 30

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = the_bronze_foothils_3
                    is_in_area = zainddian_eteradica_area_9
                }
            }
        }

        allow = {
            owns_or_subject_owns_area = the_bronze_foothils_3
            owns_or_subject_owns_area = zainddian_eteradica_area_9
        }

        on_completion = {
            add_stability = 5
            current_ruler = {
                force_add_trait = victorious
                deify_character = {
                    deity = deity:omen_shuysus
                    country = ROOT
                }
            }
            capital_scope = {
                create_state_pop = nobles
                create_state_pop = citizen
                create_state_pop = citizen
            }
            trigger_event = me_azar.8
            show_as_tooltip = {

            }
        }
    }

    03_azar_task_9 = {
        icon = "task_diplomatic"
        requires = {03_azar_task_7}

        highlight = {
            scope:province = {
                is_in_area = zainddian_eteradica_area_8
            }
        }

        allow = {
            owns_or_subject_owns_area = zainddian_eteradica_area_8
        }

        on_completion = {
            add_military_experience = 10
            add_innovation = 1
            area:zainddian_eteradica_area_9 = {
                add_provincial_claim_effect = yes
            }
            area:the_bronze_foothils_3 = {
                add_provincial_claim_effect = yes
            }
            trigger_event = me_azar.9
        }
    }

    03_azar_task_10 = {
        icon = "task_conquest"
        requires = {03_azar_task_3 03_azar_task_4}

        highlight = {
            scope:province = {
                 this = p:4262
            }
        }

        allow = {
            trigger_if = {
                limit = {
                    capital_scope.governorship = { has_legion_trigger = yes }
                    any_unit = { legion = ROOT.capital_scope.governorship.legion }
                }
                custom_tooltip = {
                    text = azar_missions_task_10_tooltip
                    any_legion = {
                        any_legion_unit = {
                            unit_size >= 6
                            any_sub_unit = {
                                count >= 6
                                sub_unit_type = heavy_infantry
                            }
                        }
                    }
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = azar_missions_task_10_tooltip
                    num_of_ships >= 1000000 #Random impossible trigger so no error log pain
                }
            }
            capital_scope = {
                is_importing_trade_good = base_metals
                is_importing_trade_good = iron
                num_of_military_building >= 1
                num_of_academy_building >= 1
                has_no_ongoing_construction = yes  
            }
            custom_tooltip = {
                text = 03_azar_task_10_tt
                any_pantheon_deity = {
                    OR = {
                        this = deity:omen_ava 
                    }
                }
            }
            has_law = magic_only_for_entrusted
        }
        on_completion = {
            trigger_event = me_azar.10
            add_country_modifier = {
                name = swords_of_axjun_azar_mod
                duration = -1
            }
            capital_scope = {
                create_state_pop = mages
                create_state_pop = mages
                create_state_pop = mages
            }
        }
    }

    03_azar_task_11 = {
        icon = "task_atlas"
        final = yes
        requires = {03_azar_task_8}

        highlight = {
            scope:province = {
                 this = p:4262
            }
        }

        allow = {
            capital_scope = {
                total_population >= 60
            }
            political_influence >= 25
            treasury >= 150 
            stability >= 50
            war = no
        }

        on_completion = {
            add_political_influence = -25
            add_treasury = -150
            change_country_name = "GOLDEN_KINGDOM_NAME"
            capital_scope = {
                set_city_status = city_metropolis
            }
            trigger_event = me_azar.11
            show_as_tooltip = {

            }
        }
    }

    03_azar_task_12 = {
        icon = "task_economical"
        requires = {03_azar_task_5}

        highlight = {
            scope:province = {
                OR = {
                    this = p:4289
                    this = p:4262
                }
            }
        }

        allow = {
            hidden:capital_scope = {
                has_building = workshop_building
                has_no_ongoing_construction = yes 
            }
            hidden:p:4289 = {
				has_building = slave_mine_building
                has_no_ongoing_construction = yes
			}
        }

        on_completion = {
            p:4262 = {
				add_road_towards = 4289
                create_state_pop = freemen
                create_state_pop = freemen
			}
            p:4289 = {
                add_permanent_province_modifier = {
                    name = iron_mines_of_rinekkud_mod
                    duration = -1
                }
            }
            add_country_modifier = {
                name = iron_weapons_azar_mod
                duration = 7300
            }
            trigger_event = me_azar.12
        }
    }

    03_azar_task_13 = {
        icon = "task_calm"
        requires = {03_azar_task_7}

        highlight = {
            scope:province = {
                this = p:4558
            }
        }

        allow = {
            owns_or_subject_owns = 4558
            p:4558 = {
                num_of_workshop_building >= 3
                has_no_ongoing_construction = yes 
            }
            invention = technology_cost_inv_1
        }

        on_completion = {
            p:4558 = {
				add_road_towards = 4463
			}
            p:4558 = {
                add_permanent_province_modifier = {
                    name = kaffarian_pepper_mills_azar_mod
                    duration = -1
                }
            }
            trigger_event = me_azar.13
        }
    }

    03_azar_task_14 = {
        icon = "task_diplomatic"
        requires = {03_azar_task_12}

        highlight = {
            scope:province = {
                OR = {
                    this = p:4262
                    this = p:4366
                    this = p:4463
                }
            }
        }

        allow = {
            treasury >= 150
            owns_or_subject_owns = 4366
            owns_or_subject_owns = 4463
            hidden:p:4463 = {
				has_building = slave_mine_building
                has_no_ongoing_construction = yes
			}
            hidden:p:4366 = {
				has_building = slave_mine_building
                has_no_ongoing_construction = yes
			}
            capital_scope = {
                has_building = forum_building
                is_importing_trade_good = marble
                is_importing_trade_good = precious_metals
                has_no_ongoing_construction = yes 
            }
        }

        on_completion = {
            add_treasury = -150
            p:4289 = {
				add_road_towards = 4361
			}
            p:4361 = {
				add_road_towards = 4366
			}
            p:4366 = {
				add_road_towards = 4463
			}
            capital_scope = {
                add_permanent_province_modifier = {
                    name = magnificent_golden_forum_of_tiuban_mod
                    duration = -1
                }
            }
            trigger_event = me_azar.14
        }
    }

    03_azar_task_15 = {
        icon = "task_expansion"
        requires = {03_azar_task_10}

        highlight = {
            scope:province = {
                this = p:4299
            }
        }

        allow = {
            trigger_if = {
                limit = {
                    capital_scope.governorship = { has_legion_trigger = yes }
                    any_unit = { legion = ROOT.capital_scope.governorship.legion }
                }
                custom_tooltip = {
                    text = 03_azar_task_15_tt
                    any_legion = {
                        any_legion_unit = {
                            unit_size >= 12
                        }
                    }
                }
            }
            trigger_else = {
                custom_tooltip = {
                    text = 03_azar_task_15_tt
                    always = no
                }
            }
        }

        on_completion = {
            trigger_event = me_azar.15
            add_military_experience = 20
            add_country_modifier = {
                name = hebric_knights_of_azar_mod
                duration = -1
            }
            show_as_tooltip = {
                p:4299 = {
                    set_trade_goods = soulgems
                }
            }
            p:4289 = {
				add_road_towards = 4299
			}
        }
    }
    
}