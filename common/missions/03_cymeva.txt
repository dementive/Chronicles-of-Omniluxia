03_cymeva = {
    header = "lotr_tribal_reform_mission_headers"
    icon = "macedon_3"

    ai_chance = { factor = 10 }

    repeatable = no
    chance = 1000

    potential = {
        NOT = { has_variable = mission_cooldown_var }
        tag = ACY
    }

    abort = {}
    on_start = {
        start_mission_ai_effect = yes
    }
    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = mission_cooldown_var
            days = 7300
        }
    }
    on_completion = {
        current_ruler = {
            average_martial_effect = yes
        }
    }



    # Cymevan National Identity
    03_cymeva_task_1 = {
        icon = "task_political"
        duration = 60

        ai_chance = { factor = 10 }

        allow = {
            war = no
            political_influence >= 25
        }

        on_completion = {
            add_political_influence = -25
            trigger_event = me_cymeva.1
        }
    }

    # Glaive Warriors
    03_cymeva_task_2 = {
        icon = "task_battle"
        requires = { 03_cymeva_task_1 }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 294
                    province_id = 345
                    province_id = 360
                    province_id = 287
                }
            }
        }

        ai_chance = { factor = 10 }

        allow = {
            war = no
            military_experience >= 5
        }

        on_completion = {
            add_military_experience = -5
            add_country_modifier = {
                name = vaur_ac_warriors_mod
                duration = 3652
            }
            hidden_effect = {
                create_unit = {
                    navy = no
                    name = "Vaur-Ac Warriors"
                    location = capital_scope
                    hidden_effect = {
                        add_subunit = heavy_infantry
                        add_subunit = heavy_infantry
                        add_subunit = heavy_infantry
                        add_subunit = heavy_infantry
                        add_subunit = heavy_infantry  
                        add_subunit = heavy_infantry
                        add_subunit = supply_train                                        
                        add_food = 150
                        add_morale = 4
                    }
                }
            }
        }
    }

    # Helots
    03_cymeva_task_3 = {
        icon = "task_expansion"
        requires = { 03_cymeva_task_1 }

        highlight = {
            scope:province = {
                OR = {
                    is_in_region = horteon_shout_region
                }
            }
        }

        ai_chance = { factor = 10 }

        allow = {
            war = no
            manpower <= 7
            political_influence >= 15
        }

        on_completion = {
            add_political_influence = -15
            add_stability = -3
            add_manpower = 2
            add_country_modifier = {
                name = cy_helot_mod
                duration = 3650
            }
            p:345 = {
                define_pop = {
                    type = slaves
                    culture = mazran
                    religion = hortenic_pantheon
                }
                define_pop = {
                    type = slaves
                    culture = mazran
                    religion = hortenic_pantheon
                }
            }
        }
    }

    # High Elven War Continues
    03_cymeva_task_4 = {
        icon = "task_heracles"
        requires = { 03_cymeva_task_2 03_cymeva_task_3 }
        duration = 180

        highlight = {
            scope:province = {
                OR = {
                    is_in_region = horteon_western_region
                }
            }
        }

        ai_chance = { factor = 10 }

        allow = {
            war = no
            political_influence >= 50
            c:ATH = {
                opinion = {
                    target = root
                    value <= 100
                }
            }
        }

        on_completion = {
            add_political_influence = -50
            custom_tooltip = me_cymeva_war_tooltip
            trigger_event = me_cymeva.2
        }
    }

    # Form High Elven Dominion
    03_cymeva_task_5 = {
        icon = "task_atlas"
        requires = { 03_cymeva_task_4 }
        final = yes

        highlight = {
            scope:province = {
                OR = {
                    is_in_region = horteon_shout_region
                    is_in_region = horteon_western_region
                }
            }
        }

        allow = {
            war = no
            stability >= 50
            owns_or_subject_owns_region = horteon_shout_region
            owns_or_subject_owns_region = horteon_western_region
        }

        on_completion = {
            custom_tooltip = "tier_3_formable_tooltip"
            if = {
                limit = {
                    NOR = { 
                        government = imperium 
                        government = imperial_cult
                    }
                }
                republic_to_monarchy_law_variable_effect = yes # decide which legion law should be transferred
                change_government = imperium
                republic_to_monarchy_law_change_effect = yes # change legion law based on variable if present
                switch_government_type_event_clearup_effect = yes
            }
            change_country_name = "Or-Andus Cymeva"
            hidden_effect = {
                change_country_adjective = "ARHADJ"
                change_country_tag = ARH
            }
            add_5_free_province_investments = yes
            capital_scope = {
                capital_formable_large_effect = yes
                formable_capital_modifier_large_effect = yes
            }
            add_country_modifier = {
                name = formable_country_huge_modifier
                duration = 7600
            }
        }
    }

    # DEVELOPMENT TREE
    # Develop Countryside Slaves
    03_cymeva_task_6 = {
        icon = "task_economical"
        requires = { 03_cymeva_task_1 }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 310
                    province_id = 343
                    province_id = 321
                    province_id = 294
                }
            }
        }

        allow = {
            p:310 = {
                has_building = basic_settlement_infratructure_building
                total_population >= 5 
            }
            p:343 = {
                has_building = basic_settlement_infratructure_building
                total_population >= 5 
            }
            p:321 = {
                has_building = basic_settlement_infratructure_building
                total_population >= 5 
            }
            p:294 = {
                has_building = basic_settlement_infratructure_building
                total_population >= 5
            }
        }

        on_completion = {
            custom_tooltip = cymeva_stooltip2
            trigger_event = me_cymeva.8
        }
    }

    # Develop Gem City
    03_cymeva_task_7 = {
        icon = "task_diplomatic"
        requires = { 03_cymeva_task_6 }
        duration = 60

        highlight = {
            scope:province = {
                OR = {
                    province_id = 360
                }
            }
        }

        allow = {
            treasury >= 150
            p:360 = {
                owner = ROOT
                has_building = workshop_building
                total_population >= 30
            }
        }

        on_completion = {
            add_treasury = -150
            p:345 = {
                add_permanent_province_modifier = {
                    name = gem_city_mod
                    duration = -1
                }
            }
            trigger_event = me_cymeva.9
        }
    }

    # Develop Capital
    03_cymeva_task_8 = {
        icon = "task_religion"
        requires = { 03_cymeva_task_7 }
        duration = 180

        highlight = {
            scope:province = {
                OR = {
                    province_id = 345
                }
            }
        }

        allow = {
            p:345 = {
                owner = ROOT
                has_building = workshop_building
                has_building = academy_building
                has_building = temple_building
                total_population >= 50
            }
        }

        on_completion = {
            p:345 = {
                add_permanent_province_modifier = {
                    name = cy_first_city_mod
                    duration = -1
                }
                define_pop = {
                    type = nobles
                    culture = cymevan
                    religion = transcendence_enlighten
                }
                define_pop = {
                    type = nobles
                    culture = cymevan
                    religion = transcendence_enlighten
                }
                define_pop = {
                    type = slaves
                    culture = mazran
                    religion = hortenic_pantheon
                }
            }
            trigger_event = me_cymeva.10
        }
    }

    # EPTELON INVASION
    # Prepare the Slaver Navy
    03_cymeva_task_9 = {
        icon = "task_battle"
        requires = { 03_cymeva_task_1 }
        duration = 60

        allow = {
            num_of_ships >= 35
        }

        on_completion = {
            add_country_modifier = {
                name = slaver_navy_mod
                duration = 3652
            }
            trigger_event = me_cymeva.11
        }
    }

    # Annex Colonies
    03_cymeva_task_10 = {
        icon = "task_political"
        requires = { 03_cymeva_task_9 }

        highlight = {
            scope:province = {
                OR = {
                    is_in_area = eptelon_north_area_1
                }
            }
        }

        allow = {
            political_influence >= 50
            owns_or_subject_owns_area = eptelon_north_area_1
            has_law = king_of_kings
        }

        on_completion = {
            custom_tooltip = cymeva_stooltip3
            custom_tooltip = cymeva_stooltip4
            hidden_effect = {
                region:eptelon_north_region = {
                    every_region_province = { add_claim = root }
                }
                region:eptelon_shout_region = {
                    every_region_province = { add_claim = root }
                }
            }
            trigger_event = me_cymeva.12
        }
    }

    # Control Eptelon
    03_cymeva_task_11 = {
        icon = "task_heracles"
        requires = { 03_cymeva_task_10 }

        highlight = {
            scope:province = {
                OR = {
                    is_in_region = eptelon_shout_region
                    is_in_region = eptelon_north_region
                }
            }
        }

        allow = {
            owns_or_subject_owns_region = eptelon_north_region
            owns_or_subject_owns_region = eptelon_shout_region
        }

        on_completion = {
            custom_tooltip = cymeva_stooltip6
            hidden_effect = {
                region:arteon_north_region = {
                    every_region_province = { add_claim = root }
                }
                region:arteon_shout_region = {
                    every_region_province = { add_claim = root }
                }
                region:arteon_western_region = {
                    every_region_province = { add_claim = root }
                }
                region:arteon_eastern_region = {
                    every_region_province = { add_claim = root }
                }
            }
            trigger_event = me_cymeva.13
        }
    }

    # EASTERN INVASION
    # Fortify the East
    03_cymeva_task_12 = {
        icon = "task_expansion"
        requires = { 03_cymeva_task_1 }

        highlight = {
            scope:province = {
                OR = {
                    province_id = 294
                }
            }
        }

        allow = {
            p:294 = {
                owner = ROOT
                has_building = fortress_building
            }
        }

        on_completion = {
            add_military_experience = 10
            custom_tooltip = cymeva_stooltip7
            hidden_effect = {
                region:horteon_shout_region = {
                    every_region_province = { add_claim = root }
                }
                region:horteon_north_region = {
                    every_region_province = { add_claim = root }
                }
            }
        }
    }

    # Take the North
    03_cymeva_task_13 = {
        icon = "task_battle"
        requires = { 03_cymeva_task_12 }

        highlight = {
            scope:province = {
                OR = {
                    is_in_region = horteon_shout_region
                }
            }
        }

        allow = {
            owns_or_subject_owns_region = horteon_shout_region
        }

        on_completion = {
            add_stability = 12
            trigger_event = me_cymeva.14
        }
    }

    # Develop Eastern Capital / Migrate into & Atheus Statue
    03_cymeva_task_14 = {
        icon = "task_religion"
        requires = { 03_cymeva_task_13 }
        duration = 180

        ai_chance = { factor = 10 }

        allow = {
            p:345 = {
                owner = ROOT
                has_building = workshop_building
                has_building = academy_building
                has_building = aqueduct_building
                has_building = fortress_building
                total_population >= 15
            }
        }

        on_completion = {
            add_political_influence = 25
            p:264 = {
                add_permanent_province_modifier = {
                    name = cy_eastern_city_mod
                    duration = -1
                }
                hidden_effect = {
                    random_pops_in_province = {
                        set_pop_culture = cymevan
                        set_pop_religion = transcendence_enlighten
                    }
                    random_pops_in_province = {
                        set_pop_culture = cymevan
                        set_pop_religion = transcendence_enlighten
                    }
                    random_pops_in_province = {
                        set_pop_culture = cymevan
                        set_pop_religion = transcendence_enlighten
                    }
                    define_pop = {
                        type = nobles
                        culture = cymevan
                        religion = transcendence_enlighten
                    }
                    define_pop = {
                        type = nobles
                        culture = cymevan
                        religion = transcendence_enlighten
                    }
                    define_pop = {
                        type = citizen
                        culture = cymevan
                        religion = transcendence_enlighten
                    }
                    define_pop = {
                        type = freemen
                        culture = cymevan
                        religion = transcendence_enlighten
                    }
                    define_pop = {
                        type = freemen
                        culture = cymevan
                        religion = transcendence_enlighten
                    }
                }
                change_province_name = Tsoresaer'Eson
                state = { set_state_capital = p:264 }
            }
            custom_tooltip = cymeva_stooltip9
            trigger_event = me_cymeva.15
        }
    }
}

