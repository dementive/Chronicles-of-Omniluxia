zerywani_1 = {
    header = "lotr_umbar_mission_header"
    icon = "lotr_tribal_reform_mission_icon"

    repeatable = no
    chance = 1000

    potential = {
        NOT = { has_variable = mission_cooldown_var }
        tag = ZC6
    }

    abort = {}
    on_start = {
        start_mission_ai_effect = yes
    }
    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = mission_cooldown_var
            days = 7300
        }
    }
    on_completion = {}
    zerywani_1_task_1 = { # Soul Forts
        icon = "task_atlas"
        requires = { zerywani_1_task_2 }
        highlight = {
            scope:province = {
                province_id = 5157
            }
        }
        allow = {
        	p:5157 = {
        		has_building = foundry_building
        		has_building = fortress_building
        	}
        }
        on_completion = {
            trigger_event = me_zechi.1
            show_as_tooltip = {
            	add_country_modifier = {
            		name = soul_forts
            		duration = -1
            	}
            }
        }
    }
    zerywani_1_task_2 = { # Empower the Mages
        icon = "task_artemis"
        duration = 90
        allow = {
        	hidden:p:5157 = {
        		custom_tooltip = {
        			any_pops_in_province = {
	        			pop_type = mages
	        		}
	        		text = empower_mages_tt
	        	}
        	}
        }
        on_completion = {
            trigger_event = me_zechi.2
            show_as_tooltip = {
            	p:5157 = {
	            	create_pop = mages
	            	create_pop = mages
	            	create_pop = mages
            		add_province_modifier = {
            			name = empowered_mage_class
            			duration = -1
            		}
            	}
            }
        }
    }
    zerywani_1_task_3 = { # University of Jelen
        icon = "task_religion"
        duration = 365
        requires = { zerywani_1_task_2 }
        highlight = {
            scope:province = {
                province_id = 5157
            }
        }
        allow = {
        	p:5157 = {
        		has_no_ongoing_construction = yes
        		num_of_academy_building >= 2
        		num_of_total_building_slots >= 7
        	}
        	treasury >= 500
        }
        on_start = {
        	trigger_event = me_zechi.300
            show_as_tooltip = {
        	   p:5157 = {
    				begin_great_work_construction = {
    					great_work = "school_of_magecraft"
    					locator = primary_great_work
    					is_ancient = yes						
    				}
    			}
                add_treasury = -500
            }
        }
        on_completion = {
            trigger_event = me_zechi.3
            show_as_tooltip = {
				p:5157 = {
					finish_great_work_construction = {
						great_work = "school_of_magecraft"
						locator = great_work
					}
				}
				current_ruler = {
					add_popularity = popularity_medium
				}
				add_political_influence = 35
				add_stability = 3
			}
        }
    }
    zerywani_1_task_4 = { # Elven Magic
        icon = "task_shiva"
        duration = 365
        requires = { zerywani_1_task_2 }
        highlight = {
            scope:province = {
                OR = {
                    dominant_province_culture = leshmian
                }
            }
        }
        allow = {
        	political_influence >= 25
        	treasury >= 100
        }
        on_start = {
        	trigger_event = me_zechi.400
        	show_as_tooltip = {
        		custom_tooltip = elven_magic_2_tt
        	}
        }
        on_completion = {
            trigger_event = me_zechi.4
            show_as_tooltip = {
            	custom_tooltip = elven_magic_1_tt
            }
        }
    }
    zerywani_1_task_5 = { # Our Younger Brothers
        icon = "task_heracles"
        requires = { zerywani_1_task_6 }
        highlight = {
        	scope:province = {
        		OR = {
        			is_in_region = lechia_region
        		}
        	}
        }
        allow = {
        	p:5149 = {
        		has_city_status = yes
        		owner = ROOT
        		has_building = court_building
        	}
        	owns_or_subject_owns_region = lechia_region
        }
        on_completion = {
            trigger_event = me_zechi.5
            show_as_tooltip = {
            	custom_tooltip = establish_lechie_vassal_tt
            }
        }
    }
    zerywani_1_task_6 = { # Winds of Change
        icon = "task_expansion"
        duration = 180
        highlight = {
        	scope:province = {
        		OR = {
        			is_in_region = lechia_region
        			is_in_region = polabowy_region
        			is_in_area = navshodia_area_8
        			is_in_area = vast_great_stepes_15
        			is_in_area = vast_great_stepes_19
        			is_in_area = vast_great_stepes_21
        		}
        	}
        }
        allow = {
        	political_influence >= 50
        	treasury >= 50
        }
        on_completion = {
            trigger_event = me_zechi.6
            show_as_tooltip = {
            	custom_tooltip = claim_zerywani_west_tt
            	add_political_influence = -50
            	add_treasury = -50
            }
        }
    }
    zerywani_1_task_7 = { # Unite the Lechii
        icon = "task_diplomatic"
        requires = { zerywani_1_task_6 }
        highlight = {
        	scope:province = {
        		OR = {
        			is_in_region = polabowy_region
        			province_id = 5131
        			province_id = 5145
        			province_id = 5136
        			province_id = 5111
        			province_id = 5101
        			province_id = 5147
        			province_id = 5157
        		}
        	}
        }
        allow = {
            owns_or_subject_owns_region = polabowy_region
            owns = 5131
            owns = 5145
            owns = 5136
            owns = 5111
            owns = 5101
            owns = 5147
            owns = 5157
        }
        on_completion = {
            trigger_event = me_zechi.7
            show_as_tooltip = {
                add_country_modifier = {
                    name = zechi_unifier
                    duration = -1
                }
                current_ruler = {
                    add_nickname = the_unifier
                }
            }
        }
    }
    zerywani_1_task_8 = { # Reconquest of Old Lechie
        icon = "task_battle"
        requires = { zerywani_1_task_6 }
        highlight = {
        	scope:province = {
        		OR = {
        			is_in_area = vast_great_stepes_15
        			is_in_area = vast_great_stepes_19
        			is_in_area = vast_great_stepes_21
        			AND = {
        				is_in_area = navshodia_area_8
        				NOR = {
	        				province_id = 5131
		        			province_id = 5145
		        			province_id = 5136
		        			province_id = 5111
		        			province_id = 5101
		        			province_id = 5147
		        			province_id = 5157
	        			}
	        		}
        		}
        	}
        }
        allow = {
            owns_area = vast_great_stepes_15
            owns_area = vast_great_stepes_19
            owns_area = vast_great_stepes_21
            owns_area = navshodia_area_8
        }
        on_completion = {
            trigger_event = me_zechi.8
            show_as_tooltip = {
                add_country_modifier = {
                    name = conquest_of_old_zechie
                    duration = 5300
                }
            }
        }
    }
    zerywani_1_task_9 = { # Punish the Alagurii
        icon = "task_conquest"
        highlight = {
        	scope:province = {
        		OR = {
        			AND = {
        				any_pops_in_province = { pop_culture_group = alaguric }
        				owner = ROOT
        			}
        		}
        	}
        }
        requires = { zerywani_1_task_5 zerywani_1_task_7 zerywani_1_task_8 }
        allow = {}
        on_completion = {
            trigger_event = me_zechi.9
            show_as_tooltip = {
                ordered_owned_province = {
                    limit = {
                        OR = {
                            dominant_province_culture = ostyakie
                            dominant_province_culture = irian
                            dominant_province_culture = samoyi
                            dominant_province_culture = fennic
                        }
                    }
                    order_by = total_population
                    max = 5
                    ordered_pops_in_province = {
                        limit = { pop_culture_group = alaguric }
                        order_by = pop_hapiness
                        max = 3
                        kill_pop = yes
                    }
                }
                custom_tooltip = repopulation_tt
                p:5172 = {
                    add_province_modifier = {
                        name = repopulation_efforts
                        duration = 9125 # 25 years
                    }
                }
            }
        }
    }
    zerywani_1_task_10 = { # Magic of Politics
        icon = "task_political"
        requires = { zerywani_1_task_4 zerywani_1_task_3 zerywani_1_task_1 }
        allow = {
        	has_law = magic_permitted
        }
        on_completion = {
            trigger_event = me_zechi.10
            show_as_tooltip = {
                add_country_modifier = {
                    name = magic_of_politics
                    duration = -1
                }
                current_ruler = {
                    add_zeal = 2
                    add_finesse = 1
                    add_popularity = 10
                }
                add_legitimacy = 10
            }
        }
    }
    zerywani_1_task_11 = { # Kingdom of the Celestial Deer
        icon = "task_athena"
        requires = { zerywani_1_task_10 zerywani_1_task_9 }
        highlight = {
        	scope:province = {
        		OR = {
        			is_in_region = polabowy_region
        			is_in_area = navshodia_area_8
        			is_in_area = vast_great_stepes_15
        			is_in_area = vast_great_stepes_19
        			is_in_area = vast_great_stepes_21
        		}
        	}
        }
		allow = {
            current_ruler = {
                popularity >= 50
            }
            legitimacy >= 75
            political_influence >= 25
        }
        on_completion = {
            trigger_event = me_zechi.11
            show_as_tooltip = {
            	change_government = magic_monarchy
            	add_4_free_province_investments = yes
            	add_innovation = 2
            	change_country_name = celestial_kingdom_name
            	change_country_adjective = zechii_adj
            	change_country_color = light_purple
                add_political_influence = -25
            }
        }
        final = yes
    }
    zerywani_1_task_12 = { # City of Elixir
        icon = "task_happiness"
        highlight = {
        	scope:province = {
        		province_id = 5121
        	}
        }
        requires = { zerywani_1_task_1 zerywani_1_task_8 }
        allow = {
        	owns = 5121
        }
        on_completion = {
            trigger_event = me_zechi.12
            show_as_tooltip = {
                p:5121 = {
                    set_trade_goods = elixir
                    add_province_modifier = {
                        name = increased_elixer_production
                        duration = -1
                    }
                    set_city_status = city
                    create_pop = mages
                }
            }
        }
    }
    zerywani_1_task_13 = { # Master of Soulgems
        icon = "task_happiness"
        duration = 365
        allow = {
        	any_owned_province = {
        		trade_goods = elixir
        	}
            trigger_if = {
                limit = {
                    owns = 5121
                }
                p:5121 = {
                    total_population >= 15
                }
            }
        }
        on_completion = {
            trigger_event = me_zechi.13
            show_as_tooltip = {
                add_country_modifier = {
                    name = elixer_of_magic
                    duration = -1
                }
            }
        }
    }
    zerywani_1_task_14 = { # Masters of Elixir
        icon = "task_happiness"
        duration = 365
        allow = {
        	any_owned_province = {
        		trade_goods = elixir
        	}
            trigger_if = {
                limit = {
                    owns = 5121
                }
                p:5121 = {
                    total_population >= 25
                }
            }
        }
        on_completion = {
            trigger_event = me_zechi.14
            show_as_tooltip = {
                add_country_modifier = {
                    name = elixir_of_harm
                    duration = -1
                }
            }
        }
    }
    zerywani_1_task_15 = { # Masters of Magic
        icon = "task_happiness"
        requires = { zerywani_1_task_13 zerywani_1_task_14 }
        allow = {
            p:5121 = {
                total_population >= 30
            }
        }
        on_completion = {
            trigger_event = me_zechi.15
            show_as_tooltip = {
                add_country_modifier = {
                    name = elixir_of_soul
                    duration = -1
                }
            }
        }
    }
}